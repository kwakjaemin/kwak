---
title: "team_real"
output: html_document
---

### 1. 서론

#### 1-1. 분석 주제
전세계적으로 비만으로 인한 사회적 비용은 2조 달러로, 전쟁과 테러로 인한 사회적 비용(2.1조 달러)과 맘먹는 수치이다. 우리나라는 OECD회원국 중에서 비만율이 가장 낮은 국가[^1]에 속해 있다. 그러나 이는 세계보건기구의 국제 비만 표준을 따라 계산했을 때의 이야기이며, 자체적으로 비만도를 조사한 경우, 2016년 기준 성인의 약 35%가 비만이라는 결과가 나온다. 그렇기 때문에 정부 차원에서 비만문제에 대한 노력이 요구되는 것은 당연하며, 실제로 비만과 관련하여 국민건강보험공단, 대한비만학회 등의 기관에서 문제해결을 위한 연구 및 노력을 계속하고 있다. 비만이 각종 성인병의 원인이 되는 것은 이미 여러 연구를 통해 입증된 결과이기 때문에 본 연구에서는 비만이 질병과 관련된 상관관계를 파악하는 것은 배제하고, 인구통계학적 특징들을 살펴볼 예정이다.
    
#### 1-2. 데이터 선정 및 소개
먼저 원자료로 국민건강보험공단에서 수집한 2015년 건강검진 데이터를 이용하였다. 여기서 신장과 체중 데이터를 이용하여 비만도를 구하고 신장별, 연령별 특징이 어떻게 나타나는지 파악한 후에 행정구역별 비만도를 통하여 연령대를 역추적해본다. 끝으로 파악한 비만율의 특징을 이를 바탕으로 정부비만정책의 올바른 방향을 논하고자 한다. 분석에서 비만도는 '브로카 지수'로 구하였다.
    
    
  [^1]: OECD의 '비만 업데이트 2017' 통계에서 우리나라는 15세 이상의 비만율이 일본(3.7%) 다음으로 낮은 수치인 5.3%를 기록하고 있다. 

### 2. 본론

#### 2-1. 데이터 사용을 위한 변수 검토 및 전처리
```{r}
##파일 불러오기
library(dplyr)
library(ggplot2)
df_raw <- read.csv("NHIS_OPEN_GJ_2015.csv")

df <- df_raw

##변수 정리

df <- rename(df,
               height = 신장.5Cm단위. ,
               weight = 체중.5Kg.단위. ,
               sex = 성별코드,
               province_num = 시도코드,
               age = 연령대코드.5세단위.)


city <- data.frame(province_num = c(11, 26, 27, 28, 29, 30, 31, 36, 41, 42, 43, 44, 45, 46, 47, 48, 49),
                   province = c("서울","부산","대구","인천","광주","대전","울산","세종","경기","강원","충북","충남","전북","전남","경북","경남","제주"))

df <- left_join(df, city, by = "province_num")

df$sex <- ifelse(df$sex == 1, "male", "female")


df$tall <- ifelse(df$height >= 180, "180",
                    ifelse(df$height >= 170, "170",
                           ifelse(df$height >= 160, "160", "150")))

##브로카지수와 비만도 구하기
df$normal_height <- (df$height-100)*0.9


df$broca <- (df$weight/df$normal_height)*100


df$obesity <- ifelse(df$broca < 90, "lack",
                       ifelse(df$broca < 110, "normal",
                              ifelse(df$broca < 120, "over", "fat")))


df$ageg <- ifelse(df$age < 6, "20대",
                    ifelse(df$age < 8, "30대",
                           ifelse(df$age < 10, "40대",
                                  ifelse(df$age < 12, "50대",
                                         ifelse(df$age < 14, "60대", "7080")))))

```
비만의 기준이 되는 브로카 지수 값은 표준체중을 구한 후 키/표준체중*100 값이다. 여기서 표준체중은 (키-100)*0.9 로 구한다.

#### 2-2. 데이터 분석
###(가설1) 키와 비만율은 관련이 있을 것이다.
```{r warning=FALSE}
#전체 키 비율
ratio <- df %>%
  count(tall, obesity) %>% 
  group_by(tall) %>% 
  mutate(per = round(n/sum(n)*100, 2))


ggplot(data = ratio, aes(x = tall, y = per, fill = obesity)) +
  geom_col() +
  coord_flip() +
  ggtitle("Whole height-obsity ratio")

cor.test(df$weight,df$broca)
```
먼저 연령대별 신장에 따른 비만도(fat) 비율 그래프이다. 키가 180cm 이상인 그룹의 비만율이 170cm, 160cm 그룹보다 높게 나타난다. 또한 키가 150cm 이하인 사람들의 비만율이 50%에 육박할 정도로 높게 나타난다.
키와 브로카지수의 관계를 보았을 때는 p-value값이 2.2e-16로 두 변수는 통계적으로 유의미하고 양의 상관관계가 나타났다.

여기서 우리는 성별에 따른 신장 차이를 고려해서 남녀를 비교분석해 볼 필요가 있다. 성별에 따른 신장 별 비만도 비율을 구하기 위해 Gridextra 패키지를 활용하여 두 그래프를 동시에 비교했다.
```{r warning=FALSE}
install.packages("gridExtra",repos = "http://cran.us.r-project.org")
library(gridExtra)

# 남자 신장별 비만도 비율
rr <- df %>%
  filter(sex == "male") %>% 
  count(tall, obesity) %>%
  group_by(tall) %>% 
  mutate(per = round(n/sum(n)*100, 2))

# 여자 신장별 비만도 비율
tt <- df %>%
  filter(sex == "female") %>% 
  count(tall, obesity) %>%
  group_by(tall) %>% 
  mutate(per = round(n/sum(n)*100, 2))


p1 <- ggplot(data = rr, aes(x = tall, y = per, fill = obesity)) +
  geom_col() +
  coord_flip()

p2 <- ggplot(data = tt, aes(x = tall, y = per, fill = obesity)) +
  geom_col() +
  coord_flip()

grid.arrange(p1, p2, ncol = 2)
```
남자에게서는 150cm 이하 군을 제외하면 비만의 차이가 크게 나타나지않는다. 여자는 가설처럼 키가 커질수록 비만율이 줄어듦을 알 수 있다.

###(가설2) 연령대가 높아질 수록 비만율은 높아진다.

```{r warning=FALSE}
pp <- df %>%
  group_by(ageg, sex) %>% 
  summarise(h = mean(height))
 
ggplot(data = pp, aes(x = ageg, y = h, group = sex, col = sex)) +
  geom_line() + 
  geom_point() +
  ggtitle("Whole ageg-height mean")
```
평균 신장은 연령대와 음의 관계를 갖는 것을 확인할 수 있다. 그렇다면 비만도는 연령대와 관련이 있을 것이고 키가 작아질 수록 즉, 연령대가 높아질 수록 비만율은 높아질 것이다.
```{r warning=FALSE}
# 연령대에 따른 비만도 비율
xx <- df %>%
  count(ageg, obesity) %>% 
  group_by(ageg) %>% 
  mutate(per = round(n/sum(n)*100, 2))

ggplot(data = xx, aes(x = ageg, y = per , fill = obesity)) +
  geom_col() +
  coord_flip()
```
비만율은 연령대 높은 집단에서 두드러지게 나타남을 볼 수 있다.

###(가설3)비만율이 높은 지역은 거주민의 연령대가 높다.
비만율을 통해 지역의 연령대를 역추적해 가설을 증명할 것이다.
```{r warning=FALSE}
# 시도별 고도비만 높은 순
  yy <- df %>% 
  count(province, obesity) %>% 
  group_by(province) %>% 
  mutate(per = round(n/sum(n)*100, 2))

list_order <- yy %>% 
  filter(obesity == "fat") %>% 
  arrange(per)

order <- list_order$province

ggplot(data = yy, aes(x = province, y = per, fill = obesity)) +
  geom_col() +
  coord_flip() +
  scale_x_discrete(limits = order) +
  ggtitle("Whole province-obsity ratio")
```
비만율이 가장 높은 곳은 강원과 울산으로 각각 33%, 25%로 나타났다.

비만율의 상위 지역 3곳과 하위 지역 3곳의 인구연령분포를 비교해보았다.

```{r warning=FALSE}
# 비만율 상위 3개 지역의 인구 분포도
# 강원
Gangwon <- df %>%
  filter(province == "강원") %>% 
  group_by(ageg, sex) %>% 
  summarise(population = n())


Gangwon_praph <- ggplot(data = Gangwon, 
       mapping = aes(x = ageg, fill = sex, 
                     y = ifelse(test = sex == "male", 
                                yes = -population, no = population))) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs, limits = max(Gangwon$population) * c(-1,1)) +
  labs(y = "population") +
  coord_flip()

# 제주
Jeju <- df %>%
  filter(province == "제주") %>% 
  group_by(ageg, sex) %>% 
  summarise(population = n())


Jeju_graph <- ggplot(data = Jeju, 
       mapping = aes(x = ageg, fill = sex, 
                     y = ifelse(test = sex == "male", 
                                yes = -population, no = population))) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs, limits = max(Jeju$population) * c(-1,1)) +
  labs(y = "population") +
  coord_flip()

# 전남
Jeonnam <- df %>%
  filter(province == "전남") %>% 
  group_by(ageg, sex) %>% 
  summarise(population = n())

Jeonnam_graph <- ggplot(data = Jeonnam, 
       mapping = aes(x = ageg, fill = sex, 
                     y = ifelse(test = sex == "male", 
                                yes = -population, no = population))) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs, limits = max(Jeonnam$population) * c(-1,1)) +
  labs(y = "population") +
  coord_flip()


# 비만율 하위 3개 지역의 인구 분포도
# 울산
Ulsan <- df %>%
  filter(province == "울산") %>% 
  group_by(ageg, sex) %>% 
  summarise(population = n())


Ulsan_graph <- ggplot(data = Ulsan, 
       mapping = aes(x = ageg, fill = sex, 
                     y = ifelse(test = sex == "male", 
                                yes = -population, no = population))) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs, limits = max(Ulsan$population) * c(-1,1)) +
  labs(y = "population") +
  coord_flip()

# 대구
Daegu <- df %>%
  filter(province == "대구") %>% 
  group_by(ageg, sex) %>% 
  summarise(population = n())


Daegu_graph <- ggplot(data = Daegu, 
       mapping = aes(x = ageg, fill = sex, 
                     y = ifelse(test = sex == "male", 
                                yes = -population, no = population))) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs, limits = max(Daegu$population) * c(-1,1)) +
  labs(y = "population") +
  coord_flip()

# 대전
Daegeon <- df %>%
  filter(province == "대전") %>% 
  group_by(ageg, sex) %>% 
  summarise(population = n())


Daegeon_graph <- ggplot(data = Daegeon, 
       mapping = aes(x = ageg, fill = sex, 
                     y = ifelse(test = sex == "male", 
                                yes = -population, no = population))) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = abs, limits = max(Daegeon$population) * c(-1,1)) +
  labs(y = "population") +
  coord_flip()


grid.arrange(Gangwon_praph, Jeju_graph, Jeonnam_graph, Ulsan_graph, Daegu_graph, Daegeon_graph, ncol = 3)
```
비만도가 높은 지역에서 60대 이상의 의 비중이 큰 것으로 나타난다.

###3. 결론
  '키와 비만율이 관련이 있을 것이다.'라는 우리의 가설은 어느 정도 맞았다. 여기서 여성과 남성의 신장차이를 고려해 성별을 나누어 보았고 성별로 나뉘어 보니 키가 커질 수록 비만율이 적어지는 것을 확인 할 수 있었다. 여기서 우리는 150cm 이하인 그룹에 공통적으로 비만율이 높은 것으로 나타났다. 그래서 우리는 연령대와 신장의 음의 관계를 확인하였고 이로 인해 연령대와 비만도도 관련있을 것이라고 추측했다. 비만율은 연령대 높은 집단에서 두드러지게 나타남을 볼 수 있다. 그렇다면 연령대가 높은 지역일 수록 비만율이 높아 질 것 이라 생각했고, 결과로 60대 이상 연령대가 많은 지역이 비만율이 높은 것으로 나타났다.
 비만은 서론에서 말했듯이 각종 성인병의 원인이 됨은 이미 많이 아는 사실이다. 그렇기때문에 비만에 대해서 더욱 연구가 필요하며 정부는 비만복지정책을 성별과 연령대로 나뉘어 60대 이상이 많은 지역을 중점으로 맞춤형 서비스를 펼쳐야한다.
 
###4. 논의

####4-1. 한계점
키와 비만율의 상관관계를 나타낸 그래프에서 키가 작은 사람의 비만율이 높은 경향을 보이는 이유를 찾지 못했고, 성별에 따른 비만율 그래프에서 남녀 차이가 왜 발생했는지 요인을 정확히 찾을 수가 없었다. 또 마지막 그래프에서 비만율 상위 3위 지역 중 제주는 60대 이상의 인구분포가 강원,전남에 비해 적어 뚜렷한 차이를 보이지 않았으며, 비만율 하위 3위 지역 중 대구도 눈에 띄는 결과는 없었다.

####4-2. 추후 분석 방향
비만에 영향을 끼치는 요소를 알기 위해서는 우리가 가진 데이터 뿐만이 아니라 운동,스트레스 등 다른 데이터를 찾아 추가적인 연구가 필요할 것이다.